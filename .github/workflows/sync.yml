name: 豆瓣电影同步到Notion

on:
  # 定时触发，每天凌晨2点执行
  schedule:
    - cron: '0 18 * * *'  # UTC时间，对应北京时间凌晨2点
  
  # 手动触发
  workflow_dispatch:
    inputs:
      sync_status:
        description: '同步状态'
        required: true
        default: 'watched'
        type: choice
        options:
          - watched
          - wish
          - do

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      # 检出代码
      - name: Checkout code
        uses: actions/checkout@v4
      
      # 设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      # 安装依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      # 配置环境变量
      - name: Configure environment variables
        run: |
          echo "DOUBAN_USER_ID=${{ secrets.DOUBAN_USER_ID }}" >> .env
          echo "DOUBAN_API_KEY=${{ secrets.DOUBAN_API_KEY }}" >> .env
          echo "NOTION_API_KEY=${{ secrets.NOTION_API_KEY }}" >> .env
          echo "NOTION_DATABASE_ID=${{ secrets.NOTION_DATABASE_ID }}" >> .env
          echo "SYNC_STATUS=${{ inputs.sync_status || 'watched' }}" >> .env
      
      # 执行同步脚本
      - name: Run sync script
        run: python main.py
